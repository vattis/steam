<!-- fragments/navbar.html -->
<div th:fragment="navbar(currentUser)">
  <!-- â–¼ fragmentì™€ í•¨ê»˜ ì‚½ì…ë˜ëŠ” ìŠ¤íƒ€ì¼: ì–´ë””ì— includeí•´ë„ ë™ì‘ -->
  <style>
    /* ìŠ¤ì½”í”„ ë˜í¼ */
    #nav-scope { display:flex; align-items:center; background:#171a21; padding:20px; }
    #nav-scope .menu-right { display:flex; align-items:center; margin-left:auto; }
    #nav-scope a { color:#c6d4df; text-decoration:none; }
    #nav-scope a:hover { color:#ffffff; }

    /* ë‹‰ë„¤ì„/ë¡œê·¸ì•„ì›ƒ ë¬¶ìŒ */
    #nav-scope .user-menu { display:inline-flex; align-items:center; gap:20px; }

    /* ë‹‰ë„¤ì„ */
    #nav-scope .user-nick {
      margin-left:40px; color:#3ecf8e; font-weight:bold; text-decoration:none;
      position:relative; z-index:2; /* í™•ì¥ hover ë²„í¼ ìœ„ì— ì˜¤ë„ë¡ */
    }

    /* ë‹‰ë„¤ì„ë§Œ ê¸°ì¤€ì  (ë ˆì´ì•„ì›ƒ ë³€í˜• ì—†ìŒ) */
    #nav-scope #nickWrap { position:relative; display:inline-block; }

    /* ğŸ”¥ Hover ë²”ìœ„ í™•ì¥ ë²„í¼(ë³´ì´ì§€ ì•ŠìŒ): ë‹‰ë„¤ì„ ì£¼ë³€+ì•„ë˜ìª½ ê°­ì„ ë©”ì›€ */
    #nav-scope #nickWrap::before,
    #nav-scope #nickWrap::after {
      content:"";
      position:absolute;
      z-index:1;
    }
    /* ì¢Œìš°/ìœ„ì•„ë˜ ì—¬ìœ  ì˜ì—­ */
    #nav-scope #nickWrap::before {
      top:-6px; bottom:-6px; left:-10px; right:-10px;
    }
    /* ë‹‰ë„¤ì„ê³¼ ë“œë¡­ë‹¤ìš´ ì‚¬ì´ì˜ 'ë¸Œë¦¬ì§€' ì˜ì—­(ê¹œë¹¡ì„ ë°©ì§€) */
    #nav-scope #nickWrap::after {
      top:100%; left:-12px; right:-12px; height:16px;
    }

    /* ê¸°ë³¸: ì™„ì „ ìˆ¨ê¹€ (ì „ì—­ CSS ì¶©ëŒ ë°©ì§€ ìœ„í•´ !important) */
    #nav-scope #friendMenu {
      position:absolute;
      top:calc(100% + 8px);
      right:0;
      min-width:180px;             /* í´ë¦­í•˜ê¸° í¸í•˜ë„ë¡ ì•½ê°„ ë„“ê²Œ */
      background:#1b2838;
      border:1px solid #2a475e;
      border-radius:8px;
      padding:10px;
      display:none !important;
      box-shadow:0 8px 20px rgba(0,0,0,.35);
      z-index:1000;
    }

    /* ë‹‰ë„¤ì„ hover/í¬ì»¤ìŠ¤ì¼ ë•Œë§Œ ë³´ì´ê¸° (ë²„í¼ ë•ë¶„ì— ì ‘ê·¼ ì‰¬ì›€) */
    #nav-scope #nickWrap:hover  #friendMenu,
    #nav-scope #nickWrap:focus-within #friendMenu {
      display:block !important;
    }

    /* 'ì¹œêµ¬ ê²€ìƒ‰' ë§í¬: ë²„íŠ¼ ì•„ë‹˜(ì‹¬í”Œ ë§í¬), í´ë¦­ ì˜ì—­ì€ ë„“ê²Œ */
    #nav-scope .friend-link {
      display:block;               /* ë¸”ë¡í™” â†’ ë„“ì€ í´ë¦­ ì˜ì—­ */
      padding:10px 14px;
      border-radius:6px;
      color:#c6d4df;
      text-decoration:none;
      white-space:nowrap;
    }
    #nav-scope .friend-link:hover { background:#2a475e; color:#fff; }

    /* ì ‘ê·¼ì„± í¬ì»¤ìŠ¤ */
    #nav-scope .user-nick:focus,
    #nav-scope .friend-link:focus {
      outline:2px solid #66c0f4;
      outline-offset:2px;
      border-radius:6px;
    }
  </style>

  <div id="nav-scope">
    <!-- ì™¼ìª½: ë¡œê³  -->
    <div style="flex-shrink:0;">
      <a href="/" style="text-decoration:none;">
        <h1 style="margin:0; color:#66c0f4;">Steam</h1>
      </a>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ë©”ë‰´ -->
    <nav class="menu-right">
      <a href="/shop/product" style="margin-left:20px;">ìƒì </a>

      <a th:if="${currentUser != null}"
         th:href="@{/library/{memberId}(memberId=${currentUser.id})}"
         style="margin-left:20px;">ë¼ì´ë¸ŒëŸ¬ë¦¬</a>

      <a href="/galleries" style="margin-left:20px;">ì»¤ë®¤ë‹ˆí‹°</a>

      <a th:if="${currentUser != null}"
         th:href="@{/shoppingCart}"
         style="margin-left:20px;">ì¥ë°”êµ¬ë‹ˆ</a>

      <!-- ë¹„ë¡œê·¸ì¸ -->
      <span sec:authorize="isAnonymous()">
        <a href="/login" style="margin-left:40px; color:#3ecf8e; font-weight:bold;">ë¡œê·¸ì¸</a>
      </span>

      <!-- ë¡œê·¸ì¸: ë‹‰ë„¤ì„ hover ì‹œ 'ì¹œêµ¬ ê²€ìƒ‰' í…ìŠ¤íŠ¸ ë§í¬ ë…¸ì¶œ (ë ˆì´ì•„ì›ƒ ê³ ì •) -->
      <span sec:authorize="isAuthenticated()" class="user-menu">
        <!-- ë‹‰ë„¤ì„ ë˜í¼(ì—¬ê¸°ì—ë§Œ hover ì ìš©) -->
        <span id="nickWrap">
          <a class="user-nick"
             th:href="@{/profile/{memberId}(memberId=${currentUser.id}, commentPageNum=${0})}"
             th:text="${currentUser.nickName}"
             aria-haspopup="true" aria-expanded="false">í”„ë¡œí•„</a>

          <!-- ì¹œêµ¬ ê²€ìƒ‰ í˜ì´ì§€ë¡œ ì´ë™ (ë²„íŠ¼ ì•„ë‹˜, í…ìŠ¤íŠ¸ ë§í¬) -->
          <div id="friendMenu" role="menu" aria-label="User quick actions">
            <a class="friend-link" th:href="@{/member/search}">íšŒì› ê²€ìƒ‰</a>
          </div>
        </span>

        <!-- ë¡œê·¸ì•„ì›ƒ: ë“œë¡­ë‹¤ìš´ê³¼ ë¶„ë¦¬(ìœ„ì¹˜ ê³ ì •) -->
        <a th:href="@{/log-out}" style="color:#ff6961; font-weight:bold;">ë¡œê·¸ì•„ì›ƒ</a>
      </span>
    </nav>
  </div>
</div>
