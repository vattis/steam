<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title th:text="${product.name}">게임 상세</title>
    <link rel="stylesheet" th:href="@{/css/product-info.css}">
</head>
<body>

<div class="container">
    <!-- 게임 헤더 -->
    <div class="game-header">
        <img th:src="${product.imageUrl}" alt="게임 이미지" class="game-image"/>
        <div class="game-info">
            <h1 th:text="${product.name}">게임 이름</h1>
            <p><strong>평점:</strong> <span th:text="${product.rate}">4.8</span>/5</p>
        </div>
    </div>

    <!-- 가격 및 할인 -->
    <div class="purchase-section">
        <div class="price-box">
            <span th:if="${product.discountDto != null && product.discountDto.isActive()}"
                  class="original-price"
                  th:text="|${product.getPrice()}원|"></span>
            <span class="discounted-price"
                  th:text="|${product.getDiscountPrice()}원|"></span>
        </div>

        <!-- 로그인 상태별 구매 버튼 -->
        <div class="purchase-button">
            <form th:action="@{/purchase}" method="post" th:if="${isLogin}">
                <input type="hidden" th:name="productId" th:value="${product.id}" />
                <button type="submit">장바구니에 담기</button>
            </form>
            <a th:if="${!isLogin}" th:href="@{/login}" class="login-link">
                로그인 후 구매하기
            </a>
        </div>
    </div>

    <!-- 리뷰 영역 시작 -->
    <div class="review-section">
        <h2>유저 리뷰</h2>

        <!-- 리뷰 입력 폼 (로그인한 유저만) -->
        <div class="review-form" th:if="${isLogin}">
            <form th:action="@{/game/{id}/review(id=${product.id})}" method="post">
                <textarea name="content" rows="3" maxlength="500" placeholder="리뷰를 입력하세요..." required></textarea>
                <div class="form-actions">
                    <button type="submit">리뷰 작성</button>
                </div>
            </form>
        </div>
        <div class="review-form" th:unless="${!isLogin}">
            <a th:href="@{/login}" class="login-link">로그인 후 리뷰 작성</a>
        </div>

        <!-- 리뷰 목록 -->
        <div class="review-list">
            <div class="review-item" th:each="comment : ${productCommentDtoPage}">
                <div class="review-meta">
                    <span class="review-user" th:text="${comment.getMember().getNickname()}">익명</span>
                    <span class="review-date" th:text="${#temporals.format(comment.createdTime, 'yyyy-MM-dd HH:mm')}">2024-07-25 11:32</span>
                </div>
                <div class="review-content" th:text="${comment.content}">
                    리뷰 내용
                </div>
            </div>
            <div th:if="${#lists.isEmpty(productCommentDtoPage)}" style="color: #888; margin-top: 16px;">
                등록된 리뷰가 없습니다.
            </div>
        </div>
    </div>
    <!-- 리뷰 영역 끝 -->
</div> <!-- .container 끝 -->
</body>
</html>